<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LetsGoPol Premium</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary: #6c5ce7;
            --primary-dark: #5649c0;
            --secondary: #a29bfe;
            --dark: #2d3436;
            --light: #f5f6fa;
            --light-gray: #f0f2f5;
            --success: #00b894;
            --success-dark: #00a884;
            --warning: #fdcb6e;
            --danger: #d63031;
            --danger-dark: #c0392b;
            --info: #0984e3;
            --border: #e0e0e0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--light-gray);
            color: var(--dark);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(108, 92, 231, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .header::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPjxkZWZzPjxwYXR0ZXJuIGlkPSJwYXR0ZXJuIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiIHBhdHRlcm5UcmFuc2Zvcm09InJvdGF0ZSg0NSkiPjxyZWN0IHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgZmlsbD0icmdiYSgyNTUsMjU1LDI1NSwwLjA1KSIvPjwvcGF0dGVybj48L2RlZnM+PHJlY3QgZmlsbD0idXJsKCNwYXR0ZXJuKSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIvPjwvc3ZnPg==');
        }
        
        .header-content {
            position: relative;
            z-index: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 28px;
            font-weight: 700;
            display: flex;
            align-items: center;
        }
        
        .logo i {
            margin-right: 10px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: white;
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
        }
        
        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
        }
        
        /* Sidebar */
        .sidebar {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            height: fit-content;
        }
        
        .points-card {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .points-card h3 {
            color: var(--dark);
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .points-amount {
            font-size: 32px;
            font-weight: 700;
            color: var(--dark);
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-item {
            margin-bottom: 10px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-radius: 8px;
            color: var(--dark);
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .nav-link:hover, .nav-link.active {
            background-color: var(--primary);
            color: white;
        }
        
        /* Content Area */
        .content-area {
            background-color: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .section-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 10px;
        }
        
        /* Focus Warning */
        .focus-warning {
            background-color: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            display: none;
        }
        
        .focus-warning i {
            margin-right: 10px;
            color: var(--warning);
        }
        
        /* Timer */
        .timer-container {
            background-color: var(--light);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .timer-text {
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .timer {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }
        
        /* Shop */
        .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .shop-item {
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .shop-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: var(--primary);
        }
        
        .shop-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .ticket-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }
        
        .ticket-price {
            background-color: var(--primary);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        .ticket-desc {
            margin-bottom: 20px;
            color: #666;
            font-size: 14px;
        }
        
        .ticket-expiry {
            font-size: 12px;
            color: var(--danger);
            margin-bottom: 10px;
            display: none;
        }
        
        .redeem-btn {
            width: 100%;
            padding: 10px;
            border: none;
            background-color: var(--primary);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .redeem-btn:hover {
            background-color: var(--primary-dark);
        }
        
        .redeem-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        /* Codes Section */
        .codes-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .enter-code {
            background-color: var(--light);
            padding: 20px;
            border-radius: 10px;
        }
        
        .code-input-container {
            display: flex;
            margin-bottom: 15px;
        }
        
        .code-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 8px 0 0 8px;
            font-size: 16px;
            border-right: none;
        }
        
        .submit-code {
            padding: 0 20px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .submit-code:hover {
            background-color: var(--primary-dark);
        }
        
        .code-result {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }
        
        .code-result.success {
            background-color: rgba(0, 184, 148, 0.1);
            color: var(--success);
            display: block;
            border: 1px solid rgba(0, 184, 148, 0.2);
        }
        
        .code-result.error {
            background-color: rgba(214, 48, 49, 0.1);
            color: var(--danger);
            display: block;
            border: 1px solid rgba(214, 48, 49, 0.2);
        }
        
        .active-codes-info {
            background-color: var(--light);
            padding: 20px;
            border-radius: 10px;
        }
        
        .codes-count {
            font-size: 36px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        /* Admin Panel */
        .admin-panel {
            display: none;
        }
        
        .admin-controls {
            margin-bottom: 30px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .admin-section {
            background-color: var(--light);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }
        
        .admin-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
        }
        
        .admin-title i {
            margin-right: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.1);
        }
        
        .form-select {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            background-color: white;
            transition: all 0.3s ease;
        }
        
        .form-select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.1);
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn i {
            font-size: 14px;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: var(--danger-dark);
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background-color: var(--success-dark);
        }
        
        /* Users Table */
        .users-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .users-table th, .users-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        .users-table th {
            background-color: var(--light);
            color: var(--dark);
            font-weight: 600;
        }
        
        .users-table tr:hover {
            background-color: #f9f9f9;
        }
        
        /* Auth Forms */
        .auth-container {
            max-width: 500px;
            margin: 50px auto;
            background-color: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
        }
        
        .auth-title {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary);
        }
        
        .auth-form .form-group {
            margin-bottom: 20px;
        }
        
        .auth-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .auth-btn:hover {
            background-color: var(--primary-dark);
        }
        
        .auth-switch {
            text-align: center;
            margin-top: 20px;
        }
        
        .auth-switch a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .codes-container {
                grid-template-columns: 1fr;
            }
        }
        
        /* Animations */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        /* Badges */
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .badge-success {
            background-color: var(--success);
            color: white;
        }
        
        .badge-warning {
            background-color: var(--warning);
            color: var(--dark);
        }
        
        .badge-danger {
            background-color: var(--danger);
            color: white;
        }
        
        /* Limited Item */
        .limited-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--danger);
            color: white;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 600;
        }
        
        /* Status Message */
        .status-message {
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        
        .status-message i {
            margin-right: 10px;
        }
        
        .status-message.success {
            background-color: rgba(0, 184, 148, 0.1);
            color: var(--success);
            border: 1px solid rgba(0, 184, 148, 0.2);
        }
        
        .status-message.warning {
            background-color: rgba(253, 203, 110, 0.1);
            color: var(--warning);
            border: 1px solid rgba(253, 203, 110, 0.2);
        }
        
        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Error Message */
        .error-message {
            color: var(--danger);
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Auth Screens -->
    <div id="auth-screens">
        <div class="auth-container" id="login-form">
            <h1 class="auth-title"><i class="fas fa-sign-in-alt"></i> Iniciar Sesión</h1>
            <form class="auth-form" id="loginForm">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="login-email" required>
                    <div class="error-message" id="login-email-error"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Contraseña</label>
                    <input type="password" class="form-input" id="login-password" required>
                    <div class="error-message" id="login-password-error"></div>
                </div>
                <button type="submit" class="auth-btn" id="login-btn">
                    <span id="login-btn-text">Ingresar</span>
                </button>
            </form>
            <div class="auth-switch">
                ¿No tienes cuenta? <a href="#" id="show-register">Regístrate</a>
            </div>
        </div>
        
        <div class="auth-container" id="register-form" style="display: none;">
            <h1 class="auth-title"><i class="fas fa-user-plus"></i> Registrarse</h1>
            <form class="auth-form" id="registerForm">
                <div class="form-group">
                    <label class="form-label">Nombre</label>
                    <input type="text" class="form-input" id="register-name" required>
                    <div class="error-message" id="register-name-error"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="register-email" required>
                    <div class="error-message" id="register-email-error"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Contraseña</label>
                    <input type="password" class="form-input" id="register-password" required minlength="6">
                    <div class="error-message" id="register-password-error"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Confirmar Contraseña</label>
                    <input type="password" class="form-input" id="register-confirm-password" required minlength="6">
                    <div class="error-message" id="register-confirm-error"></div>
                </div>
                <button type="submit" class="auth-btn" id="register-btn">
                    <span id="register-btn-text">Crear Cuenta</span>
                </button>
            </form>
            <div class="auth-switch">
                ¿Ya tienes cuenta? <a href="#" id="show-login">Inicia Sesión</a>
            </div>
        </div>
    </div>
    
    <!-- Main App (hidden until auth) -->
    <div id="app-container" style="display: none;">
        <div class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-coins"></i> LetsGoPol
                </div>
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar">U</div>
                    <div>
                        <div id="user-name">Usuario</div>
                        <div style="font-size: 12px;" id="user-email">usuario@email.com</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="sidebar">
                <div class="points-card">
                    <h3>Tus Puntos</h3>
                    <div class="points-amount" id="total-points">0</div>
                </div>
                
                <ul class="nav-menu">
                    <li class="nav-item"><a href="#" class="nav-link active" onclick="showSection('earn')"><i class="fas fa-bolt"></i> Ganar Puntos</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" onclick="showSection('shop')"><i class="fas fa-shopping-bag"></i> Tienda</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" onclick="showSection('codes')"><i class="fas fa-tag"></i> Códigos</a></li>
                    <li class="nav-item" id="admin-nav-item" style="display: none;"><a href="#" class="nav-link" onclick="showSection('admin')"><i class="fas fa-lock"></i> Administración</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</a></li>
                </ul>
            </div>
            
            <div class="content-area">
                <!-- Focus Warning -->
                <div class="focus-warning" id="focus-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>¡La página debe estar visible y en primer plano para ganar puntos!</div>
                </div>
                
                <!-- Earn Points Section -->
                <div id="earn-section" class="app-section">
                    <h2 class="section-title"><i class="fas fa-bolt"></i> Ganar Puntos</h2>
                    
                    <div class="timer-container">
                        <div class="timer-text">Próximo punto en:</div>
                        <div class="timer" id="countdown">60</div>
                    </div>
                    
                    <div class="status-message success" id="focus-status">
                        <i class="fas fa-check-circle"></i> ¡Página activa! Ganando puntos...
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h3><i class="fas fa-info-circle"></i> Cómo ganar puntos</h3>
                        <p style="margin-top: 10px;">Mantén esta página abierta y visible para ganar puntos automáticamente. Ganas 1 punto cada 60 segundos mientras la página esté activa.</p>
                        
                        <div style="margin-top: 20px; background-color: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid var(--border);">
                            <h4><i class="fas fa-gem"></i> Multiplicador de Puntos</h4>
                            <p>Tu multiplicador actual: <span id="multiplier-display" class="badge badge-primary">1x</span></p>
                        </div>
                    </div>
                </div>
                
                <!-- Shop Section -->
                <div id="shop-section" class="app-section" style="display: none;">
                    <h2 class="section-title"><i class="fas fa-shopping-bag"></i> Tienda de Tickets</h2>
                    <p>Canjea tus puntos por tickets de valor.</p>
                    
                    <div class="shop-items" id="shop-items-container">
                        <!-- Shop items will be loaded here -->
                    </div>
                </div>
                
                <!-- Codes Section -->
                <div id="codes-section" class="app-section" style="display: none;">
                    <h2 class="section-title"><i class="fas fa-tag"></i> Códigos Promocionales</h2>
                    
                    <div class="codes-container">
                        <div class="enter-code">
                            <h3><i class="fas fa-ticket-alt"></i> Ingresar Código</h3>
                            <div class="code-input-container">
                                <input type="text" class="code-input" id="promo-code" placeholder="Ingresa tu código aquí">
                                <button class="submit-code" onclick="submitCode()"><i class="fas fa-paper-plane"></i></button>
                            </div>
                            <div class="code-result" id="code-result"></div>
                        </div>
                        
                        <div class="active-codes-info">
                            <h3><i class="fas fa-fire"></i> Códigos Activos</h3>
                            <div class="codes-count" id="active-codes-count">0</div>
                            <p>Actualmente hay códigos promocionales disponibles. Ingresa un código para recibir puntos extra.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Admin Section -->
                <div id="admin-section" class="app-section" style="display: none;">
                    <h2 class="section-title"><i class="fas fa-lock"></i> Panel de Administración</h2>
                    
                    <div class="admin-controls">
                        <button class="btn btn-primary" onclick="showAdminTab('codes')"><i class="fas fa-tags"></i> Gestionar Códigos</button>
                        <button class="btn btn-primary" onclick="showAdminTab('users')"><i class="fas fa-users"></i> Gestionar Usuarios</button>
                        <button class="btn btn-primary" onclick="showAdminTab('products')"><i class="fas fa-box-open"></i> Gestionar Productos</button>
                    </div>
                    
                    <!-- Admin Codes -->
                    <div id="admin-codes-tab">
                        <div class="admin-section">
                            <h3 class="admin-title"><i class="fas fa-plus-circle"></i> Crear Nuevo Código</h3>
                            <form id="create-code-form">
                                <div class="form-group">
                                    <label class="form-label">Código</label>
                                    <input type="text" class="form-input" id="new-code" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Tipo</label>
                                    <select class="form-select" id="code-type" required>
                                        <option value="points">Puntos fijos</option>
                                        <option value="multiplier">Multiplicador</option>
                                    </select>
                                </div>
                                <div class="form-group" id="points-amount-group">
                                    <label class="form-label">Cantidad de Puntos</label>
                                    <input type="number" class="form-input" id="code-points" min="1" required>
                                </div>
                                <div class="form-group" id="multiplier-group" style="display: none;">
                                    <label class="form-label">Multiplicador</label>
                                    <input type="number" class="form-input" id="code-multiplier" min="1" step="0.1" value="2" required>
                                </div>
                                <div class="form-group" id="duration-group" style="display: none;">
                                    <label class="form-label">Duración (minutos)</label>
                                    <input type="number" class="form-input" id="code-duration" min="1" value="60" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Fecha de Expiración</label>
                                    <input type="datetime-local" class="form-input" id="code-expiration">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Límite de Usos (0 = ilimitado)</label>
                                    <input type="number" class="form-input" id="code-uses" min="0" value="0">
                                </div>
                                <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Crear Código</button>
                            </form>
                        </div>
                        
                        <div class="admin-section">
                            <h3 class="admin-title"><i class="fas fa-list"></i> Códigos Existentes</h3>
                            <div id="codes-list">
                                <p>No hay códigos creados aún.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Admin Users -->
                    <div id="admin-users-tab" style="display: none;">
                        <div class="admin-section">
                            <h3 class="admin-title"><i class="fas fa-search"></i> Buscar Usuario</h3>
                            <div class="form-group">
                                <input type="text" class="form-input" id="user-search" placeholder="Buscar por nombre o email">
                            </div>
                            <button class="btn btn-primary" onclick="searchUsers()"><i class="fas fa-search"></i> Buscar</button>
                        </div>
                        
                        <div class="admin-section">
                            <h3 class="admin-title"><i class="fas fa-users"></i> Usuarios</h3>
                            <table class="users-table">
                                <thead>
                                    <tr>
                                        <th>Nombre</th>
                                        <th>Email</th>
                                        <th>Puntos</th>
                                        <th>Multiplicador</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="users-table-body">
                                    <!-- Users will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Admin Products -->
                    <div id="admin-products-tab" style="display: none;">
                        <div class="admin-section">
                            <h3 class="admin-title"><i class="fas fa-plus-circle"></i> Crear Nuevo Producto</h3>
                            <form id="create-product-form">
                                <div class="form-group">
                                    <label class="form-label">Nombre del Producto</label>
                                    <input type="text" class="form-input" id="product-name" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Valor del Ticket ($)</label>
                                    <input type="number" class="form-input" id="product-value" min="1" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Precio en Puntos</label>
                                    <input type="number" class="form-input" id="product-price" min="1" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Descripción</label>
                                    <textarea class="form-input" id="product-desc" rows="3"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="product-limited"> ¿Producto limitado?
                                    </label>
                                </div>
                                <div class="form-group" id="product-expiry-group" style="display: none;">
                                    <label class="form-label">Fecha de Expiración</label>
                                    <input type="datetime-local" class="form-input" id="product-expiration">
                                </div>
                                <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Crear Producto</button>
                            </form>
                        </div>
                        
                        <div class="admin-section">
                            <h3 class="admin-title"><i class="fas fa-list"></i> Productos Existentes</h3>
                            <div id="products-list">
                                <p>No hay productos creados aún.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // App State
        const state = {
            user: null,
            points: 0,
            timer: 60,
            isPageActive: true,
            pointMultiplier: 1,
            usedCodes: [],
            activePromoCodes: {},
            shopProducts: {},
            adminMode: false,
            currentSection: 'earn',
            currentAdminTab: 'codes',
            users: {}, // Database of users
            timerInterval: null
        };
        
        // Admin credentials
        const ADMIN_EMAIL = 'polpostigo@gmail.com';
        const ADMIN_PASSWORD = 'pol90emma';
        
        // DOM Elements
        const authScreens = document.getElementById('auth-screens');
        const appContainer = document.getElementById('app-container');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize database
            initializeDatabase();
            
            // Set up event listeners
            document.getElementById('show-register').addEventListener('click', showRegisterForm);
            document.getElementById('show-login').addEventListener('click', showLoginForm);
            
            // Form submissions
            document.getElementById('loginForm').addEventListener('submit', login);
            document.getElementById('registerForm').addEventListener('submit', register);
            
            // Admin form listeners
            document.getElementById('code-type').addEventListener('change', function() {
                if (this.value === 'points') {
                    document.getElementById('points-amount-group').style.display = 'block';
                    document.getElementById('multiplier-group').style.display = 'none';
                    document.getElementById('duration-group').style.display = 'none';
                } else {
                    document.getElementById('points-amount-group').style.display = 'none';
                    document.getElementById('multiplier-group').style.display = 'block';
                    document.getElementById('duration-group').style.display = 'block';
                }
            });
            
            document.getElementById('product-limited').addEventListener('change', function() {
                document.getElementById('product-expiry-group').style.display = this.checked ? 'block' : 'none';
            });
            
            document.getElementById('create-code-form').addEventListener('submit', function(e) {
                e.preventDefault();
                createNewCode();
            });
            
            document.getElementById('create-product-form').addEventListener('submit', function(e) {
                e.preventDefault();
                createNewProduct();
            });
            
            // Check if user is logged in
            checkAuthStatus();
        });
        
        function initializeDatabase() {
            // Initialize with admin user
            state.users[ADMIN_EMAIL] = {
                name: 'Administrador',
                email: ADMIN_EMAIL,
                password: ADMIN_PASSWORD,
                points: 0,
                multiplier: 1,
                isAdmin: true,
                avatar: 'A'
            };
            
            // Load from localStorage if available
            const savedUsers = localStorage.getItem('letsgopol-users');
            if (savedUsers) {
                state.users = JSON.parse(savedUsers);
            }
            
            // Load active promos
            const savedPromos = localStorage.getItem('letsgopol-promos');
            if (savedPromos) {
                state.activePromoCodes = JSON.parse(savedPromos);
            }
            
            // Load shop products
            const savedProducts = localStorage.getItem('letsgopol-products');
            if (savedProducts) {
                state.shopProducts = JSON.parse(savedProducts);
            }
            
            // Add some sample products if none exist
            if (Object.keys(state.shopProducts).length === 0) {
                state.shopProducts = {
                    prod1: {
                        id: 'prod1',
                        name: 'Ticket $10',
                        value: 10,
                        price: 1000,
                        desc: 'Ticket canjeable por $10 en servicios participantes',
                        limited: false,
                        expiration: null
                    },
                    prod2: {
                        id: 'prod2',
                        name: 'Ticket $20',
                        value: 20,
                        price: 1800,
                        desc: 'Ticket canjeable por $20 en servicios participantes',
                        limited: false,
                        expiration: null
                    },
                    prod3: {
                        id: 'prod3',
                        name: 'Ticket $50 (Oferta)',
                        value: 50,
                        price: 4000,
                        desc: '¡Oferta especial! Ticket canjeable por $50 en servicios participantes',
                        limited: true,
                        expiration: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString()
                    }
                };
                saveDatabase();
            }
        }
        
        function saveDatabase() {
            localStorage.setItem('letsgopol-users', JSON.stringify(state.users));
            localStorage.setItem('letsgopol-promos', JSON.stringify(state.activePromoCodes));
            localStorage.setItem('letsgopol-products', JSON.stringify(state.shopProducts));
        }
        
        function checkAuthStatus() {
            const loggedInUser = localStorage.getItem('letsgopol-user');
            
            if (loggedInUser) {
                try {
                    const userData = JSON.parse(loggedInUser);
                    const user = state.users[userData.email];
                    
                    if (user && user.password === userData.password) {
                        state.user = user;
                        state.points = user.points || 0;
                        state.pointMultiplier = user.multiplier || 1;
                        state.usedCodes = JSON.parse(localStorage.getItem(`used-codes-${user.email}`)) || [];
                        
                        // Check if admin
                        if (user.email === ADMIN_EMAIL) {
                            state.adminMode = true;
                        }
                        
                        initializeApp();
                    } else {
                        // Invalid credentials, force logout
                        logout();
                    }
                } catch (e) {
                    logout();
                }
            }
        }
        
        // Auth Functions
        function showRegisterForm(e) {
            if (e) e.preventDefault();
            loginForm.style.display = 'none';
            registerForm.style.display = 'block';
            clearErrors();
        }
        
        function showLoginForm(e) {
            if (e) e.preventDefault();
            registerForm.style.display = 'none';
            loginForm.style.display = 'block';
            clearErrors();
        }
        
        function clearErrors() {
            document.querySelectorAll('.error-message').forEach(el => {
                el.style.display = 'none';
                el.textContent = '';
            });
        }
        
        function showError(id, message) {
            const element = document.getElementById(id);
            element.textContent = message;
            element.style.display = 'block';
        }
        
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.position = 'fixed';
            notification.style.bottom = '20px';
            notification.style.right = '20px';
            notification.style.backgroundColor = type === 'success' ? 'var(--success)' : 
                                             type === 'error' ? 'var(--danger)' : 
                                             type === 'info' ? 'var(--info)' : 'var(--primary)';
            notification.style.color = 'white';
            notification.style.padding = '15px 20px';
            notification.style.borderRadius = '8px';
            notification.style.zIndex = '1000';
            notification.style.boxShadow = '0 3px 10px rgba(0,0,0,0.2)';
            notification.style.display = 'flex';
            notification.style.alignItems = 'center';
            notification.style.maxWidth = '400px';
            notification.style.wordBreak = 'break-word';
            
            const icon = document.createElement('i');
            icon.className = type === 'success' ? 'fas fa-check-circle' : 
                            type === 'error' ? 'fas fa-exclamation-circle' : 
                            'fas fa-info-circle';
            icon.style.marginRight = '10px';
            
            notification.prepend(icon);
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transition = 'all 0.3s ease';
                notification.style.opacity = '0';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }
        
        function login(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value.trim().toLowerCase();
            const password = document.getElementById('login-password').value;
            const loginBtn = document.getElementById('login-btn');
            const loginBtnText = document.getElementById('login-btn-text');
            
            // Clear previous errors
            clearErrors();
            
            // Validate inputs
            let isValid = true;
            
            if (!email) {
                showError('login-email-error', 'Por favor ingresa tu email');
                isValid = false;
            }
            
            if (!password) {
                showError('login-password-error', 'Por favor ingresa tu contraseña');
                isValid = false;
            }
            
            if (!isValid) return;
            
            // Show loading state
            loginBtn.disabled = true;
            loginBtnText.innerHTML = '<div class="spinner"></div>';
            
            // Simulate network delay
            setTimeout(() => {
                const user = state.users[email];
                
                if (user && user.password === password) {
                    state.user = user;
                    state.points = user.points || 0;
                    state.pointMultiplier = user.multiplier || 1;
                    state.usedCodes = JSON.parse(localStorage.getItem(`used-codes-${user.email}`)) || [];
                    
                    // Check if admin
                    if (user.email === ADMIN_EMAIL) {
                        state.adminMode = true;
                    }
                    
                    // Save user session
                    localStorage.setItem('letsgopol-user', JSON.stringify({
                        email: user.email,
                        password: user.password
                    }));
                    
                    initializeApp();
                } else {
                    showError('login-password-error', 'Email o contraseña incorrectos');
                    loginBtn.disabled = false;
                    loginBtnText.textContent = 'Ingresar';
                }
            }, 800);
        }
        
        function register(e) {
            e.preventDefault();
            const name = document.getElementById('register-name').value.trim();
            const email = document.getElementById('register-email').value.trim().toLowerCase();
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            const registerBtn = document.getElementById('register-btn');
            const registerBtnText = document.getElementById('register-btn-text');
            
            // Clear previous errors
            clearErrors();
            
            // Validate inputs
            let isValid = true;
            
            if (!name) {
                showError('register-name-error', 'Por favor ingresa tu nombre');
                isValid = false;
            }
            
            if (!email) {
                showError('register-email-error', 'Por favor ingresa tu email');
                isValid = false;
            } else if (!/^\S+@\S+\.\S+$/.test(email)) {
                showError('register-email-error', 'Por favor ingresa un email válido');
                isValid = false;
            }
            
            if (!password) {
                showError('register-password-error', 'Por favor ingresa una contraseña');
                isValid = false;
            } else if (password.length < 6) {
                showError('register-password-error', 'La contraseña debe tener al menos 6 caracteres');
                isValid = false;
            }
            
            if (!confirmPassword) {
                showError('register-confirm-error', 'Por favor confirma tu contraseña');
                isValid = false;
            } else if (password !== confirmPassword) {
                showError('register-confirm-error', 'Las contraseñas no coinciden');
                isValid = false;
            }
            
            if (!isValid) return;
            
            // Check if email already exists
            if (state.users[email]) {
                showError('register-email-error', 'Este email ya está registrado');
                return;
            }
            
            // Show loading state
            registerBtn.disabled = true;
            registerBtnText.innerHTML = '<div class="spinner"></div>';
            
            // Simulate network delay
            setTimeout(() => {
                // Create new user
                const newUser = {
                    name: name,
                    email: email,
                    password: password,
                    points: 0,
                    multiplier: 1,
                    isAdmin: false,
                    avatar: name.charAt(0).toUpperCase()
                };
                
                // Add to database
                state.users[email] = newUser;
                saveDatabase();
                
                // Set as current user
                state.user = newUser;
                
                // Save user session
                localStorage.setItem('letsgopol-user', JSON.stringify({
                    email: newUser.email,
                    password: newUser.password
                }));
                
                initializeApp();
            }, 800);
        }
        
        function logout() {
            // Clear timer
            if (state.timerInterval) {
                clearInterval(state.timerInterval);
                state.timerInterval = null;
            }
            
            // Clear session
            localStorage.removeItem('letsgopol-user');
            state.user = null;
            
            // Show auth screens
            authScreens.style.display = 'block';
            appContainer.style.display = 'none';
            showLoginForm();
        }
        
        // App Functions
        function initializeApp() {
            // Hide auth screens, show app
            authScreens.style.display = 'none';
            appContainer.style.display = 'block';
            
            // Reset buttons
            document.getElementById('login-btn-text').textContent = 'Ingresar';
            document.getElementById('login-btn').disabled = false;
            document.getElementById('register-btn-text').textContent = 'Crear Cuenta';
            document.getElementById('register-btn').disabled = false;
            
            // Update user info
            document.getElementById('user-name').textContent = state.user.name;
            document.getElementById('user-email').textContent = state.user.email;
            document.getElementById('user-avatar').textContent = state.user.avatar;
            
            // Show/hide admin nav
            document.getElementById('admin-nav-item').style.display = state.user.isAdmin ? 'block' : 'none';
            
            // Load data
            updatePointsDisplay();
            updateShopButtons();
            updateActiveCodesCount();
            renderShopItems();
            
            // Start the points timer
            startTimer();
            
            // Set up visibility checks
            setupVisibilityChecks();
            
            // Show current section
            showSection(state.currentSection);
        }
        
        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('.app-section').forEach(el => {
                el.style.display = 'none';
            });
            
            // Show selected section
            document.getElementById(`${section}-section`).style.display = 'block';
            
            // Update active nav link
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Set the clicked link as active
            event.currentTarget.classList.add('active');
            
            // Store current section
            state.currentSection = section;
            
            // Special handling for admin tabs
            if (section === 'admin') {
                showAdminTab(state.currentAdminTab);
            }
        }
        
        function showAdminTab(tab) {
            // Hide all admin tabs
            document.getElementById('admin-codes-tab').style.display = 'none';
            document.getElementById('admin-users-tab').style.display = 'none';
            document.getElementById('admin-products-tab').style.display = 'none';
            
            // Show selected tab
            document.getElementById(`admin-${tab}-tab`).style.display = 'block';
            
            // Store current admin tab
            state.currentAdminTab = tab;
            
            // Load data if needed
            if (tab === 'users') {
                loadUsers();
            } else if (tab === 'products') {
                renderProductsList();
            } else if (tab === 'codes') {
                renderCodesList();
            }
        }
        
        // Points System
        function startTimer() {
            // Clear any existing timer
            if (state.timerInterval) {
                clearInterval(state.timerInterval);
            }
            
            // Start new timer
            state.timerInterval = setInterval(function() {
                if (state.isPageActive) {
                    state.timer--;
                    document.getElementById('countdown').textContent = state.timer;
                    
                    if (state.timer <= 0) {
                        addPoints(1 * state.pointMultiplier);
                        state.timer = 60;
                    }
                }
            }, 1000);
        }
        
        function addPoints(amount) {
            state.points += amount;
            state.user.points = state.points;
            
            // Update database
            state.users[state.user.email].points = state.points;
            saveDatabase();
            
            updatePointsDisplay();
            updateShopButtons();
            
            // Show notification
            showNotification(`+${amount} punto${amount !== 1 ? 's' : ''}!`, 'success');
        }
        
        function updatePointsDisplay() {
            document.getElementById('total-points').textContent = state.points.toLocaleString();
            document.getElementById('multiplier-display').textContent = `${state.pointMultiplier}x`;
        }
        
        // Visibility Checks
        function setupVisibilityChecks() {
            // Clear existing listeners to avoid duplicates
            document.removeEventListener('visibilitychange', handleVisibilityChange);
            window.removeEventListener('blur', handleWindowBlur);
            window.removeEventListener('focus', handleWindowFocus);
            
            // Add new listeners
            document.addEventListener('visibilitychange', handleVisibilityChange);
            window.addEventListener('blur', handleWindowBlur);
            window.addEventListener('focus', handleWindowFocus);
            
            // Initial check
            checkPageActivity();
        }
        
        function handleVisibilityChange() {
            if (document.hidden) {
                pageInactive();
            } else {
                pageActive();
            }
        }
        
        function handleWindowBlur() {
            pageInactive();
        }
        
        function handleWindowFocus() {
            pageActive();
        }
        
        function checkPageActivity() {
            if (!document.hidden && document.hasFocus()) {
                pageActive();
            } else {
                pageInactive();
            }
        }
        
        function pageActive() {
            state.isPageActive = true;
            document.getElementById('focus-warning').style.display = 'none';
            document.getElementById('focus-status').innerHTML = '<i class="fas fa-check-circle"></i> ¡Página activa! Ganando puntos...';
            document.getElementById('focus-status').className = 'status-message success';
        }
        
        function pageInactive() {
            state.isPageActive = false;
            document.getElementById('focus-warning').style.display = 'flex';
            document.getElementById('focus-status').innerHTML = '<i class="fas fa-exclamation-circle"></i> Página inactiva. No se ganan puntos.';
            document.getElementById('focus-status').className = 'status-message warning';
        }
        
        // Shop System
        function renderShopItems() {
            const container = document.getElementById('shop-items-container');
            container.innerHTML = '';
            
            const now = new Date();
            
            for (const [id, product] of Object.entries(state.shopProducts)) {
                // Skip expired products
                if (product.expiration && new Date(product.expiration) < now) {
                    continue;
                }
                
                const item = document.createElement('div');
                item.className = 'shop-item';
                
                let limitedBadge = '';
                let expiryInfo = '';
                
                if (product.limited && product.expiration) {
                    limitedBadge = '<div class="limited-badge">LIMITADO</div>';
                    const expiryDate = new Date(product.expiration);
                    expiryInfo = `<div class="ticket-expiry">Disponible hasta: ${expiryDate.toLocaleDateString()} ${expiryDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>`;
                }
                
                item.innerHTML = `
                    ${limitedBadge}
                    <div class="shop-item-header">
                        <div class="ticket-value">$${product.value}</div>
                        <div class="ticket-price">${product.price.toLocaleString()} pts</div>
                    </div>
                    <div class="ticket-desc">${product.desc}</div>
                    ${expiryInfo}
                    <button class="redeem-btn" onclick="redeemTicket('${id}', ${product.price}, ${product.value})">Canjear</button>
                `;
                
                container.appendChild(item);
            }
            
            updateShopButtons();
        }
        
        function updateShopButtons() {
            const buttons = document.querySelectorAll('.redeem-btn');
            buttons.forEach(button => {
                const pointsRequired = parseInt(button.getAttribute('onclick').match(/\d+/g)[1]);
                button.disabled = state.points < pointsRequired;
            });
        }
        
        function redeemTicket(productId, pointsCost, ticketValue) {
            if (state.points >= pointsCost) {
                if (confirm(`¿Quieres canjear ${pointsCost.toLocaleString()} puntos por un ticket de $${ticketValue}?`)) {
                    state.points -= pointsCost;
                    state.user.points = state.points;
                    
                    // Update database
                    state.users[state.user.email].points = state.points;
                    saveDatabase();
                    
                    updatePointsDisplay();
                    updateShopButtons();
                    
                    showNotification(`¡Ticket de $${ticketValue} canjeado con éxito!`, 'success');
                }
            } else {
                showNotification('No tienes suficientes puntos para canjear este ticket.', 'error');
            }
        }
        
        // Promo Codes System
        function submitCode() {
            const codeInput = document.getElementById('promo-code');
            const code = codeInput.value.trim().toUpperCase();
            const resultDiv = document.getElementById('code-result');
            
            if (!code) {
                resultDiv.innerHTML = '<i class="fas fa-exclamation-circle"></i> Por favor ingresa un código.';
                resultDiv.className = 'code-result error';
                return;
            }
            
            if (state.usedCodes.includes(code)) {
                const promo = state.activePromoCodes[code];
                if (!promo || !promo.reusable) {
                    resultDiv.innerHTML = '<i class="fas fa-exclamation-circle"></i> Este código ya ha sido usado.';
                    resultDiv.className = 'code-result error';
                    return;
                }
            }
            
            if (state.activePromoCodes[code]) {
                const promo = state.activePromoCodes[code];
                const now = new Date();
                
                // Check expiration
                if (promo.expiration && new Date(promo.expiration) < now) {
                    resultDiv.innerHTML = '<i class="fas fa-exclamation-circle"></i> Este código ha expirado.';
                    resultDiv.className = 'code-result error';
                    return;
                }
                
                // Check uses left
                if (promo.usesLeft !== undefined && promo.usesLeft <= 0) {
                    resultDiv.innerHTML = '<i class="fas fa-exclamation-circle"></i> Este código ya no tiene usos disponibles.';
                    resultDiv.className = 'code-result error';
                    return;
                }
                
                // Apply code
                if (promo.type === 'points') {
                    addPoints(promo.points);
                    resultDiv.innerHTML = `<i class="fas fa-check-circle"></i> ¡Código válido! Has ganado ${promo.points} puntos.`;
                    resultDiv.className = 'code-result success';
                } else if (promo.type === 'multiplier') {
                    state.pointMultiplier = promo.multiplier;
                    state.user.multiplier = promo.multiplier;
                    
                    // Update database
                    state.users[state.user.email].multiplier = promo.multiplier;
                    saveDatabase();
                    
                    document.getElementById('multiplier-display').textContent = `${promo.multiplier}x`;
                    resultDiv.innerHTML = `<i class="fas fa-check-circle"></i> ¡Código válido! Tus puntos se multiplicarán por ${promo.multiplier} durante ${promo.duration/60} minutos.`;
                    resultDiv.className = 'code-result success';
                    
                    setTimeout(() => {
                        state.pointMultiplier = 1;
                        state.user.multiplier = 1;
                        
                        // Update database
                        state.users[state.user.email].multiplier = 1;
                        saveDatabase();
                        
                        document.getElementById('multiplier-display').textContent = '1x';
                        showNotification('Tu multiplicador de puntos ha expirado.', 'info');
                    }, promo.duration * 1000);
                }
                
                // Mark as used if not reusable
                if (!promo.reusable) {
                    state.usedCodes.push(code);
                    localStorage.setItem(`used-codes-${state.user.email}`, JSON.stringify(state.usedCodes));
                }
                
                // Decrement uses left
                if (promo.usesLeft !== undefined) {
                    promo.usesLeft--;
                    state.activePromoCodes[code].usesLeft = promo.usesLeft;
                    saveDatabase();
                }
            } else {
                resultDiv.innerHTML = '<i class="fas fa-exclamation-circle"></i> Código no válido o ha expirado.';
                resultDiv.className = 'code-result error';
            }
            
            codeInput.value = '';
        }
        
        function updateActiveCodesCount() {
            const now = new Date();
            const activeCodes = Object.values(state.activePromoCodes).filter(code => {
                return !code.expiration || new Date(code.expiration) > now;
            }).length;
            
            document.getElementById('active-codes-count').textContent = activeCodes;
        }
        
        // Admin Functions
        function createNewCode() {
            const code = document.getElementById('new-code').value.trim().toUpperCase();
            const type = document.getElementById('code-type').value;
            const points = parseInt(document.getElementById('code-points').value);
            const multiplier = parseFloat(document.getElementById('code-multiplier').value);
            const duration = parseInt(document.getElementById('code-duration').value) * 60;
            const expiration = document.getElementById('code-expiration').value;
            const uses = parseInt(document.getElementById('code-uses').value) || 0;
            
            if (!code) {
                showNotification('Por favor ingresa un código', 'error');
                return;
            }
            
            if (state.activePromoCodes[code]) {
                showNotification('Este código ya existe', 'error');
                return;
            }
            
            // Validate based on type
            if (type === 'points' && (!points || points < 1)) {
                showNotification('Por favor ingresa una cantidad válida de puntos', 'error');
                return;
            }
            
            if (type === 'multiplier' && (!multiplier || multiplier < 1)) {
                showNotification('Por favor ingresa un multiplicador válido', 'error');
                return;
            }
            
            if (type === 'multiplier' && (!duration || duration < 60)) {
                showNotification('Por favor ingresa una duración válida (mínimo 1 minuto)', 'error');
                return;
            }
            
            // Create code object
            const newCode = {
                type: type,
                reusable: uses !== 1,
                expiration: expiration || null,
                usesLeft: uses || null
            };
            
            if (type === 'points') {
                newCode.points = points;
            } else {
                newCode.multiplier = multiplier;
                newCode.duration = duration;
            }
            
            // Add to active codes
            state.activePromoCodes[code] = newCode;
            saveDatabase();
            
            // Update UI
            updateActiveCodesCount();
            renderCodesList();
            
            // Reset form
            document.getElementById('create-code-form').reset();
            document.getElementById('points-amount-group').style.display = 'block';
            document.getElementById('multiplier-group').style.display = 'none';
            document.getElementById('duration-group').style.display = 'none';
            
            showNotification(`Código "${code}" creado exitosamente`, 'success');
        }
        
        function renderCodesList() {
            const codesList = document.getElementById('codes-list');
            
            if (Object.keys(state.activePromoCodes).length === 0) {
                codesList.innerHTML = '<p>No hay códigos creados aún.</p>';
                return;
            }
            
            let html = '<div style="overflow-x: auto;"><table style="width: 100%; border-collapse: collapse;">';
            html += '<thead><tr><th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border);">Código</th><th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border);">Tipo</th><th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border);">Valor</th><th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border);">Expiración</th><th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border);">Usos</th><th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border);">Acciones</th></tr></thead><tbody>';
            
            const now = new Date();
            
            for (const [code, details] of Object.entries(state.activePromoCodes)) {
                const isExpired = details.expiration && new Date(details.expiration) < now;
                
                html += `<tr style="${isExpired ? 'opacity: 0.6;' : ''}">
                    <td style="padding: 10px; border-bottom: 1px solid var(--border);">${code}</td>
                    <td style="padding: 10px; border-bottom: 1px solid var(--border);">${details.type === 'points' ? 'Puntos' : 'Multiplicador'}</td>
                    <td style="padding: 10px; border-bottom: 1px solid var(--border);">${
                        details.type === 'points' ? 
                        `${details.points} pts` : 
                        `${details.multiplier}x por ${Math.floor(details.duration/60)} min`
                    }</td>
                    <td style="padding: 10px; border-bottom: 1px solid var(--border);">${
                        details.expiration ? 
                        new Date(details.expiration).toLocaleDateString() + ' ' + new Date(details.expiration).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : 
                        'No expira'
                    }</td>
                    <td style="padding: 10px; border-bottom: 1px solid var(--border);">${details.usesLeft === null ? 'Ilimitado' : details.usesLeft}</td>
                    <td style="padding: 10px; border-bottom: 1px solid var(--border);">
                        <button class="btn btn-danger" onclick="deleteCode('${code}')"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>`;
            }
            
            html += '</tbody></table></div>';
            codesList.innerHTML = html;
        }
        
        function deleteCode(code) {
            if (confirm(`¿Estás seguro de querer eliminar el código "${code}"?`)) {
                delete state.activePromoCodes[code];
                saveDatabase();
                updateActiveCodesCount();
                renderCodesList();
                showNotification(`Código "${code}" eliminado`, 'success');
            }
        }
        
        function loadUsers() {
            // Convert users object to array and exclude admin
            const usersArray = Object.values(state.users).filter(user => user.email !== ADMIN_EMAIL);
            renderUsersTable(usersArray);
        }
        
        function searchUsers() {
            const searchTerm = document.getElementById('user-search').value.toLowerCase();
            const usersArray = Object.values(state.users).filter(user => 
                user.email !== ADMIN_EMAIL && 
                (user.name.toLowerCase().includes(searchTerm) || 
                user.email.toLowerCase().includes(searchTerm))
            );
            
            renderUsersTable(usersArray);
        }
        
        function renderUsersTable(users) {
            const tbody = document.getElementById('users-table-body');
            tbody.innerHTML = '';
            
            if (users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">No se encontraron usuarios</td></tr>';
                return;
            }
            
            users.forEach(user => {
                const tr = document.createElement('tr');
                
                tr.innerHTML = `
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.points.toLocaleString()}</td>
                    <td>${user.multiplier}x</td>
                    <td>
                        <button class="btn btn-primary" onclick="editUserMultiplier('${user.email}', ${user.multiplier})"><i class="fas fa-edit"></i> Multiplicador</button>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
        }
        
        function editUserMultiplier(email, currentMultiplier) {
            const newMultiplier = prompt(`Editar multiplicador para ${email}\n\nMultiplicador actual: ${currentMultiplier}x\n\nIngresa el nuevo multiplicador:`, currentMultiplier);
            
            if (newMultiplier && !isNaN(newMultiplier)) {
                const multiplierValue = parseFloat(newMultiplier);
                
                if (multiplierValue >= 1) {
                    // Update in database
                    state.users[email].multiplier = multiplierValue;
                    saveDatabase();
                    
                    // Update current user if it's them
                    if (state.user.email === email) {
                        state.pointMultiplier = multiplierValue;
                        state.user.multiplier = multiplierValue;
                        document.getElementById('multiplier-display').textContent = `${multiplierValue}x`;
                    }
                    
                    showNotification(`Multiplicador de ${email} actualizado a ${multiplierValue}x`, 'success');
                    
                    // Update the table
                    const rows = document.querySelectorAll('#users-table-body tr');
                    rows.forEach(row => {
                        if (row.cells[1].textContent === email) {
                            row.cells[3].textContent = `${multiplierValue}x`;
                        }
                    });
                } else {
                    showNotification('El multiplicador debe ser al menos 1', 'error');
                }
            } else if (newMultiplier !== null) {
                showNotification('Por favor ingresa un valor numérico válido', 'error');
            }
        }
        
        // Product Management
        function createNewProduct() {
            const name = document.getElementById('product-name').value.trim();
            const value = parseInt(document.getElementById('product-value').value);
            const price = parseInt(document.getElementById('product-price').value);
            const desc = document.getElementById('product-desc').value.trim() || `Ticket canjeable por $${value} en servicios participantes.`;
            const isLimited = document.getElementById('product-limited').checked;
            const expiration = isLimited ? document.getElementById('product-expiration').value : null;
            
            if (!name || !value || !price) {
                showNotification('Por favor completa los campos requeridos', 'error');
                return;
            }
            
            if (value < 1 || price < 1) {
                showNotification('El valor y el precio deben ser mayores a 0', 'error');
                return;
            }
            
            if (isLimited && !expiration) {
                showNotification('Por favor ingresa una fecha de expiración para productos limitados', 'error');
                return;
            }
            
            // Create product ID
            const id = 'prod' + Date.now().toString().slice(-5);
            
            // Add to products
            state.shopProducts[id] = {
                id: id,
                name: name,
                value: value,
                price: price,
                desc: desc,
                limited: isLimited,
                expiration: expiration
            };
            
            saveDatabase();
            
            // Update UI
            renderShopItems();
            renderProductsList();
            
            // Reset form
            document.getElementById('create-product-form').reset();
            document.getElementById('product-expiry-group').style.display = 'none';
            document.getElementById('product-limited').checked = false;
            
            showNotification(`Producto "${name}" creado exitosamente`, 'success');
        }
        
        function renderProductsList() {
            const productsList = document.getElementById('products-list');
            
            if (Object.keys(state.shopProducts).length === 0) {
                productsList.innerHTML = '<p>No hay productos creados aún.</p>';
                return;
            }
            
            let html = '<div style="overflow-x: auto;"><table style="width: 100%; border-collapse: collapse;">';
            html += '<thead><tr><th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border);">Nombre</th><th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border);">Valor</th><th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border);">Precio</th><th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border);">Limitado</th><th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border);">Expiración</th><th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border);">Acciones</th></tr></thead><tbody>';
            
            const now = new Date();
            
            for (const [id, product] of Object.entries(state.shopProducts)) {
                const isExpired = product.expiration && new Date(product.expiration) < now;
                
                html += `<tr style="${isExpired ? 'opacity: 0.6;' : ''}">
                    <td style="padding: 10px; border-bottom: 1px solid var(--border);">${product.name}</td>
                    <td style="padding: 10px; border-bottom: 1px solid var(--border);">$${product.value}</td>
                    <td style="padding: 10px; border-bottom: 1px solid var(--border);">${product.price.toLocaleString()} pts</td>
                    <td style="padding: 10px; border-bottom: 1px solid var(--border);">${product.limited ? 'Sí' : 'No'}</td>
                    <td style="padding: 10px; border-bottom: 1px solid var(--border);">${
                        product.expiration ? 
                        new Date(product.expiration).toLocaleDateString() + ' ' + new Date(product.expiration).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : 
                        'No expira'
                    }</td>
                    <td style="padding: 10px; border-bottom: 1px solid var(--border);">
                        <button class="btn btn-danger" onclick="deleteProduct('${id}')"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>`;
            }
            
            html += '</tbody></table></div>';
            productsList.innerHTML = html;
        }
        
        function deleteProduct(id) {
            if (confirm(`¿Estás seguro de querer eliminar este producto?`)) {
                delete state.shopProducts[id];
                saveDatabase();
                renderShopItems();
                renderProductsList();
                showNotification('Producto eliminado', 'success');
            }
        }
    </script>
</body>
</html>
